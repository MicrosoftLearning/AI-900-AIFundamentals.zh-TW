---
lab:
  title: 探索 Azure ML 中的自動化機器學習
---

# 探索 Azure ML 中的自動化機器學習

在此練習中，您將探索 Azure Machine Learning 中的自動化機器學習功能，並用它來定型和評估機器學習模型。 接著，您將部署及測試定型的模型。

此實驗室需要大約 **30** 分鐘才能完成。

> **注意** 若要完成此實驗室，您需要一個具備[系統管理存取權](https://azure.microsoft.com/free)的 Azure 訂用帳戶。

## 建立 Azure Machine Learning 工作區

若要存取 Azure Machine Learning 工作區，您必須先在 Azure 訂用帳戶中建立 Azure Machine Learning 服務。 然後，您將能夠使用Azure Machine Learning 工作室來處理工作區中的資源。

> **提示 ** ：如果您已經有 Azure 機器學習 工作區，您可以使用該工作區並跳至下一個工作。

1. 使用您的 Microsoft 認證登入 Azure 入口網站。

1. 選取 [&#65291;建立資源]****、搜尋「機器學習」**，然後使用下列設定建立新的 [機器學習]**** 資源：
    - **訂用帳戶**：*您的 Azure 訂用帳戶*。
    - **資源群組**：建立或選取資源群組**。
    - 輸入工作區的唯一名稱
    - **區域**：選取最接近的地理區域**。
    - **儲存體帳戶**：留意將為您的工作區建立的預設新儲存體帳戶**。
    - **金鑰保存庫**：留意將為您的工作區建立的預設新金鑰保存庫**。
    - **應用程式見解**：留意將為您的工作區建立的預設新應用程式見解資源**。
    - **容器登錄**：無 (第一次將模型部署到容器時會自動建立**)。

1. 選取 [檢閱 + 建立]****,然後選取 [建立]****。 等候工作區建立 (可能需要幾分鐘)，然後移至已部署的資源。

1. 選取 [啟動工作室]**** (或開啟新的瀏覽器索引標籤，並瀏覽至 [https://ml.azure.com](https://ml.azure.com?azure-portal=true)，然後使用您的 Microsoft 帳戶登入 Azure Machine Learning 工作室)。 關閉顯示的任何訊息。

1. 在 Azure Machine Learning 工作室中，您應該會看到新建立的工作區。 如果沒有，請選取 ** 左側功能表中的 [所有工作區 ** ]，然後選取您剛才建立的工作區。

## 啟用預覽功能

Azure 機器學習的某些功能處於預覽狀態，而且必須在工作區中明確啟用。

1. 在 Azure 機器學習 Studio 中，按一下 ** [管理預覽功能 ** ] （響亮的喇叭圖示 - &#128363;]。

    ![功能表上 [管理預覽功能] 按鈕的螢幕擷取畫面。](../instructions/media/use-automated-machine-learning/severless-compute-1.png)

1. 啟用下列預覽功能：

    - *使用無伺服器計算提交定型作業的引導式體驗*

## 使用自動化機器學習來定型模型。

自動化機器學習可讓您嘗試多個演算法和參數來定型多個模型，並找出資料的最佳演算法和參數。 在此練習下，您將使用自行車租借歷史詳細資料的資料集將模型定型，該模型會根據季節和氣象特徵，預測指定日期預期的自行車租借數目。

> **引文**：此資料衍生自 [Capital Bikeshare](https://www.capitalbikeshare.com/system-data)，並按照已發佈的資料[授權合約](https://www.capitalbikeshare.com/data-license-agreement)來使用**。


1. 在 [Azure Machine Learning Studio](https://ml.azure.com?azure-portal=true) 中，檢視 [自動化 ML]**** 頁面 (位在 [作者]**** 下)。

1. 使用下列設定建立新的自動化 ML 作業，並視需要使用 ** Next ** 來逐步執行使用者介面：

    **基本設定**

    - **作業名稱 ** ：mslearn-bike-automl
    - **新的實驗名稱**：mslearn-bike-rental
    - **描述 ** ：適用于自行車出租預測的自動化機器學習
    - **標籤 ** ： * 無*

   **工作類型與資料 ** ：

    - **選取工作類型 ** ：回歸
    - **選取資料集 ** ：使用下列設定建立新的資料集：
        - **資料類型**：
            - **名稱**：bike-rentals
            - **描述 ** ：歷史自行車出租資料
            - **類型 ** ：表格式
        - **資料來源**。
            - 選取 [從檔案]****。
        - Web URL：
            - **Web URL**：`https://aka.ms/bike-rentals`
            - **略過資料驗證**：*請不要選取*
        - **設定**：
            - **檔案格式**：分隔
            - **分隔符號**：逗號
            - **編碼**：UTF-8
            - **資料行標題**：只有第一個檔案有標題
            - **跳過資料列**：無
            - **資料集包含多行資料**：請勿選取**
        - **結構描述**：
            - 包含 [路徑]**** 以外的所有欄
            - 檢閱自動偵測到的類型

        建立 ** 自行車出租 ** 資料集之後，請選取它。

    工作設定

    - **工作類型 ** ：回歸
    - **資料集**：bike-rentals
    - **目標資料行 ** ：出租（整數）
    - **其他組態設定：**
        - 主要計量：選取 [標準化均方根誤差]
        - **說明最佳模型 ** ： * 未選取*
        - **使用所有支援的模型**：<u>未</u>選取。 您將限制作業只嘗試幾個特定演算法。**
        - **允許的模型**：只選取 **RandomForest** 和 **LightGBM** - 通常建議盡可能嘗試，但每新增一個模型就會增加執行作業所需的時間。**
    - **限制 ** ： * 展開本節*
        - **最大試用版 ** ：3
        - **並行試用版 ** 上限：3
        - **最大節點 ** 數：3
        - **計量分數閾值**：0.085 - 模型達到 0.085 或更小的標準化均方根誤差計量分數時，作業就結束。**
        - timeout=60
        - **反復專案逾時 ** ：5
        - 啟用提前終止。
    - 測試和驗證
        - **驗證類型 ** ：定型驗證分割
        - **驗證資料的 ** 百分比：10
        - **測試資料集 ** ：無

    **計算**：

    - **選取計算類型 ** ：無伺服器
    - **虛擬機器類型**：CPU
    - **虛擬機器層**：專用
    - **虛擬機器大小**：Standard_DS11_v2
    - 執行個體數目

1. 提交訓練作業 WinPE 會自動啟動。

1. 請等候作業完成。 這可能需要一些時間，現在或許是喝咖啡休息的好時機！

## 檢閱最佳模型

當自動化機器學習作業完成時，您可以檢閱其定型的最佳模型。

1. 在自動化機器學習作業的 [概觀]**** 索引標籤上，留意最佳模型摘要。
    ![螢幕擷取畫面：自動化機器學習的最佳模型摘要，其中已框住演算法名稱。](media/use-automated-machine-learning/complete-run.png)

    > 您可能會在狀態下看到「警告: 使用者指定的退出分數已達到...」訊息。 這是預期的訊息。 請繼續下一個步驟。
  
1. 選取最佳模型 [演算法名稱]**** 下方的文字，以檢視其詳細資料。

1. 選取 [計量]**** 索引標籤，然後選取**殘差**與 **predicted_true** 圖表 (如果尚未選取)。 

    檢閱顯示模型效能的圖表。 **殘差圖表會將殘差 ** * （預測值與實際值之間的差異）顯示為 * 長條圖。 predicted_true ** ** 圖表會比較預測值與 true 值。 

## 部署和測試模型

1. 在 [模型]**** 索引標籤上，選取 [部署]**** 按鈕，然後使用 [部署至 Web 服務]**** 選項搭配下列設定來部署模型：
    - **名稱**：predict-rentals
    - **描述**：預測自行車租借
    - **計算類型**：Azure 容器執行個體
    - 啟用驗證：已選取

1. 等待部署啟動，這可能需要幾秒鐘的時間。 **預測租用 ** 端點的 ** [部署狀態 ** ] 將會在頁面的主要部分中指出為 * [執行中 * ]。
1. 等候狀態變更為 [訓練成功]。 這可能需要幾分鐘的時間。

## 測試已部署的服務

現在您可以測試已部署的服務。

1. 在 Azure Machine Learning Studio 中，檢視 [端點]**** 頁面，然後選取 **predict-rentals** 即時端點。

1. 在 [端點]**** 頁面上，開啟 **predict-rentals** 即時端點。

1. 在 [輸入資料以測試即時端點]**** 窗格中，將範本 JSON 換成下列輸入資料：

    ```JSON
    {
      "Inputs": { 
        "data": [
          {
            "day": 1,
            "mnth": 1,   
            "year": 2022,
            "season": 2,
            "holiday": 0,
            "weekday": 1,
            "workingday": 1,
            "weathersit": 2, 
            "temp": 0.3, 
            "atemp": 0.3,
            "hum": 0.3,
            "windspeed": 0.3 
          }
        ]    
      },   
      "GlobalParameters": 1.0
    }
    ```

1. 按一下 [測試]**** 按鈕。

1. 檢閱測試結果，其中包含根據輸入特徵預測的租賃次數。

    ```JSON
    {
      "Results": [
        444.27799000000000
      ]
    }
    ```

    測試窗格取得輸入資料，並使用您定型的模型，以傳回預測的租賃次數。

讓我們檢閱您已完成的工作。 您已使用歷程記錄自行車租借資料的資料集來定型模型。 此模型會根據季節性和氣象*特徵*，預測指定一天預期的自行車租借數量。

## 清理

您建立的 Web 服務會裝載在 *Azure 容器執行個體*中。 如果您不打算進一步試驗此服務，則應刪除端點，以避免產生不必要的 Azure 使用量。

1. 在 [Azure Machine Learning Studio](https://ml.azure.com?azure-portal=true) 的 [端點]**** 索引標籤上，選取 **predict-rentals** 端點。 然後，選取 [刪除] ****，並確認您想要刪除該端點。

    停止您的計算可確保您的訂用帳戶不需支付計算資源的費用。 不過，只要您的訂用帳戶中有 Azure Machine Learning 工作區，您就必須為了資料儲存空間支付少量的費用。 如果您已完成探索 Azure Machine Learning，則可刪除 Azure Machine Learning 工作區及其相關的資源。

若要刪除您的工作區：

1. 在 [Azure 入口網站](https://portal.azure.com?azure-portal=true)的 [資源群組]**** 頁面中，開啟在建立 Azure Machine Learning 工作區時所指定的資源群組。
2. 按一下 [刪除資源群組]****、輸入資源群組名稱以確認要刪除，然後選取 [刪除]****。
